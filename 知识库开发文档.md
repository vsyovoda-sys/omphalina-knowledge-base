# Omphalina 知识库开发文档

> 项目代号：Omphalina · 历史物质模拟器
> 更新日期：2026-02-07
> 状态：架构已确认，待搭建

---

## 一、架构总览

知识库采用**两层分离架构**：
第二层：storylines/ ← LLM 创作层（戏剧节点 · 因果网络 · 评分）
第一层：encyclopedia/ ← 搬运层（Wikipedia · 诺贝尔档案 · 权威文献）


- **第一层**是"书"——从权威来源搬运的化合物发展史全景，要求详尽、可信
- **第二层**是"剧本"——基于第一层提取高张力节点，编排游戏故事线，LLM 发挥创作

两层独立扩展：加新化合物只需拉取 Wikipedia（第一层），故事线可单独迭代（第二层）。

---

## 二、目录结构
knowledge_base/
├── encyclopedia/ # 第一层：全景知识库
│ ├── compounds/ # 化合物百科（每个一个 .md）
│ │ ├── aspirin.md
│ │ ├── synthetic_ammonia.md
│ │ ├── plastics.md
│ │ ├── ddt.md
│ │ ├── cfc.md
│ │ ├── penicillin.md
│ │ └── msg.md
│ ├── people/ # 关键人物传记
│ ├── topics/ # 专题补充条目
│ └── metadata.json # 索引（来源URL · 更新日期 · token数）
│
├── storylines/ # 第二层：游戏故事线
│ ├── compounds/ # 每个化合物的故事线 YAML
│ ├── cross_connections.yaml # 跨化合物因果连接
│ └── schema.yaml # 故事线字段定义
│
├── scripts/ # 工具脚本
│ ├── fetch_wikipedia.py # Wikipedia 批量拉取
│ ├── fetch_wikidata.py # Wikidata 结构化数据拉取
│ ├── graph_builder.py # YAML → NetworkX 因果图
│ └── query_engine.py # 图遍历 + Gemini prompt
│
└── README.md

英文 Wikipedia 为主体（历史叙事更全面），中文 Wikipedia 独有内容合入"中国语境补充"章节。

体量估算
内容	Token 量	占 Gemini 1M 窗口
7 个化合物 EN+ZH	~131,000	13%
独立历史专题（3篇）	~60,000	6%
人物传记 + 诺贝尔	~40,000	4%
监管历史补充	~15,000	1.5%
总计	~246,000	~25%
全量可注入 Gemini 上下文，无需 RAG 分块。

四、第二层：游戏故事线
格式：YAML
选择理由：需要结构化字段（drama_score 等）供程序读取；人类可审核。

节点类型（4种）
类型	说明
Compound	化合物本体
Person	关键人物
Event	历史事件
Consequence	后果/涟漪
边类型（6种）
边	连接
INVENTED_BY	Compound → Person
ENABLED	Compound → Event
CAUSED	Event → Consequence
IRONIC_TWIST	Consequence → Consequence
DERIVED_FROM	Compound → Compound
CONTEMPORANEOUS	Event ↔ Event
评分体系
drama_score (0-1)：规模 30% · 意外性 25% · 跨领域度 20% · 时间跨度 15% · 可引用性 10%

irony_level (0-1)：目的反转 40% · 同一主体矛盾 30% · 事后讽刺 20% · 叙事张力 10%

图引擎：NetworkX
storylines/ 的 YAML 加载为 nx.DiGraph()，边携带 drama_score、irony_level 等属性，供 Gemini 实时查询最具张力的因果路径。

五、MVP 化合物清单（7个）
#	化合物	日常名	年代	核心张力
1	乙酰水杨酸	阿司匹林	1897	最古老万能药，不断发现新用途
2	合成氨	化肥	1909	养活40亿人 ↔ 一战毒气弹基础
3	高分子聚合物	塑料	1907	材料革命 ↔ 全球最大污染源
4	二氯二苯三氯乙烷	DDT	1939	诺贝尔灭疟 ↔ 催生环保运动
5	氯氟碳化合物	氟利昂	1928	完美制冷剂 ↔ 臭氧层空洞
6	半合成抗生素	青霉素	1942	拯救千万生命 ↔ 超级细菌
7	谷氨酸钠	味精	1908	鲜味科学 ↔ 种族偏见伪科学
覆盖 1897–至今（130+ 年）。4 个任何中国人都认识的名字。化合物间有丰富互连。

六、搭建步骤
步骤	任务	产出
1	编写 fetch_wikipedia.py，拉取 7 化合物 + 3 专题的 EN/ZH Wikipedia 全文	encyclopedia/compounds/.md, topics/.md
2	编写 fetch_wikidata.py，拉取结构化元数据	写入 .md 文件头部"基本信息"章节
3	运行脚本，生成全景知识库，人工确认完整性	~25万 token 的 Markdown
4	编写 schema.yaml，定义故事线数据结构	storylines/schema.yaml
5	LLM 基于知识库生成故事线（注入 .md → Gemini 提取节点 → 输出 YAML）	storylines/compounds/*.yaml
6	手动策划跨化合物连接	cross_connections.yaml
7	编写 graph_builder.py + query_engine.py	可运行的图引擎
七、技术栈
组件	选型	理由
知识库格式	Markdown	LLM 语义理解最优，人类可读
故事线格式	YAML	结构化字段，程序可读
数据拉取	wikipedia-api + SPARQLWrapper	按章节提取 + 跨语言链接
图引擎	NetworkX (Python)	零基建，原生有向图，后期可迁移 Neo4j
AI 引擎	Gemini API	Google 黑客松要求
八、安全红线
所有条目 禁止包含 合成方法/配方/具体反应参数
Schema 强制要求 safety_note 字段
query_engine 过滤任何合成步骤相关输出
探索物质的 历史与哲学，绝不提供"如何制造"的指导